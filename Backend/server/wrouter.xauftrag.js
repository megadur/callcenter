var express = require('express');
var router = express.Router();

var wrouter = require("./wrouter");

var thisArg = {
    router: router,
    db: 'xauftrag',
    sAlias: 'AA'
};

//region  all

// wrouter(thisArg, "/", "SELECT 'ACCOUNT' AS TBL, A.* FROM IDMA_BESTANDS_OPDB_DATA.X_ACCOUNT A WHERE  rownum <= 10");

//endregion

//region  query

wrouter(thisArg, "/",
    "SELECT  'X_AUFTRAG' AS TBL, A.*, AU.* \
\r\n FROM IDMA_AUFTRAGS_OPDB_DATA.X_ACCOUNT_INFO AI \
\r\n INNER JOIN IDMA_BESTANDS_OPDB_DATA.X_ACCOUNT A ON A.TO_NR=AI.TO_NR \
\r\n INNER JOIN IDMA_AUFTRAGS_OPDB_DATA.X_AUFTRAG AU ON AI.O_ID=AU.EO_ID \
\r\n WHERE 1=1 \
\r\n AND (A.GUID=:GUID OR :GUID IS NULL ) \
\r\n AND (AU.EO_ID=:EO_ID OR :EO_ID IS NULL ) \
\r\n AND (AU.SO_ID=:SO_ID OR :SO_ID IS NULL ) \
\r\n AND (AU.SO_TYPE_ID=:SO_TYPE_ID OR :SO_TYPE_ID IS NULL ) \
\r\n AND rownum <= 10 \
\r\n ORDER BY AU.TS_LAST_UPDATE \
", "query.GUID", "query.GUID", "query.EOID", "query.EOID", "query.SOID", "query.SOID", "query.SOTYPEID", "query.SOTYPEID"
)
//endregion

//#region param

wrouter(thisArg, "/:GUID", "SELECT  'X_AUFTRAG' AS TBL, AU.*  \
\r\n FROM IDMA_AUFTRAGS_OPDB_DATA.X_ACCOUNT_INFO AI \
\r\n INNER JOIN IDMA_BESTANDS_OPDB_DATA.X_ACCOUNT A ON A.TO_NR=AI.TO_NR \
\r\n INNER JOIN IDMA_AUFTRAGS_OPDB_DATA.X_AUFTRAG AU ON AI.O_ID=AU.EO_ID \
\r\n WHERE A.GUID=:GUID \
", "GUID");

wrouter(thisArg, "/:GUID/XHisAuftrag",
    "SELECT  'X_HIS_AUFTRAG' AS TBL, XH.*  \
FROM IDMA_AUFTRAGS_OPDB_DATA.X_ACCOUNT_INFO AI \
INNER JOIN IDMA_BESTANDS_OPDB_DATA.X_ACCOUNT A ON A.TO_NR=AI.TO_NR \
INNER JOIN IDMA_AUFTRAGS_DISPDB_DATA.X_HIS_AUFTRAG XH ON AI.O_ID=XH.EO_ID \
WHERE A.GUID=:GUID \
ORDER BY XH.TS_LAST_UPDATE ", "GUID");

wrouter(thisArg, "/:GUID/XAuftrag",
    "SELECT  'X_AUFTRAG' AS TBL, AU.*  \
FROM IDMA_AUFTRAGS_OPDB_DATA.X_ACCOUNT_INFO AI \
INNER JOIN IDMA_BESTANDS_OPDB_DATA.X_ACCOUNT A ON A.TO_NR=AI.TO_NR \
INNER JOIN IDMA_AUFTRAGS_OPDB_DATA.X_AUFTRAG AU ON AI.O_ID=AU.EO_ID \
WHERE A.GUID=:GUID \
ORDER BY AU.TS_LAST_UPDATE ", "GUID");

wrouter(thisArg, "/:GUID/XAuftragExt",
    "SELECT  'X_AUFTRAG_EXT ' AS TBL, AX.*  \
FROM IDMA_AUFTRAGS_OPDB_DATA.X_ACCOUNT_INFO AI \
INNER JOIN IDMA_BESTANDS_OPDB_DATA.X_ACCOUNT A ON A.TO_NR=AI.TO_NR \
INNER JOIN IDMA_AUFTRAGS_OPDB_DATA.X_AUFTRAG_EXT AX ON AI.O_ID=AX.EO_ID \
WHERE A.GUID=:GUID \
ORDER BY AX.LAST_UPD ", "GUID");

wrouter(thisArg, "/:GUID/XAuftragExt2Sof",
    "SELECT  'X_AUFTRAG_EXT_2_SOF' AS TBL, A2S.*  \
FROM IDMA_AUFTRAGS_OPDB_DATA.X_ACCOUNT_INFO AI \
INNER JOIN IDMA_BESTANDS_OPDB_DATA.X_ACCOUNT A ON A.TO_NR=AI.TO_NR \
INNER JOIN IDMA_AUFTRAGS_OPDB_DATA.X_AUFTRAG_EXT_2_SOF A2S ON AI.O_ID=A2S.EO_ID \
WHERE A.GUID=:GUID \
ORDER BY A2S.LAST_UPD ", "GUID");

wrouter(thisArg, "/:GUID/XMessage",
    "SELECT  'X_MESSAGES' AS TBL, XM.*  \
FROM IDMA_AUFTRAGS_OPDB_DATA.X_ACCOUNT_INFO AI \
INNER JOIN IDMA_BESTANDS_OPDB_DATA.X_ACCOUNT A ON A.TO_NR=AI.TO_NR \
INNER JOIN IDMA_AUFTRAGS_DISPDB_DATA.X_MESSAGES XM ON AI.O_ID=XM.EO_ID \
WHERE A.GUID=:GUID \
ORDER BY XM.ID ", "GUID");

wrouter(thisArg, "/:GUID/XError",
    "SELECT  'X_ERROR' AS TBL, XE.*  \
FROM IDMA_AUFTRAGS_OPDB_DATA.X_ACCOUNT_INFO AI \
INNER JOIN IDMA_BESTANDS_OPDB_DATA.X_ACCOUNT A ON A.TO_NR=AI.TO_NR \
INNER JOIN IDMA_AUFTRAGS_OPDB_DATA.X_ERROR XE ON AI.O_ID=XE.EO_ID \
WHERE A.GUID=:GUID \
ORDER BY XE.LAST_UPD", "GUID");

//#endregion


module.exports = router;